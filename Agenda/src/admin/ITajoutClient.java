/*
 * To change this license header, choose License Headers in Project Properties.
 * To change this template file, choose Tools | Templates
 * and open the template in the editor.
 */
package admin;

import static gestionagenda.GestionAgenda.rq;
import java.sql.SQLException;
import java.util.logging.Level;
import java.util.logging.Logger;
import javax.swing.JOptionPane;
import java.awt.Dimension;
import javax.swing.GroupLayout.Alignment;
import javax.swing.GroupLayout;
import javax.swing.LayoutStyle.ComponentPlacement;
import javax.swing.SwingConstants;
import java.awt.Component;
import javax.swing.JTextField;
import javax.swing.JComboBox;
import javax.swing.JLabel;

/**
 *
 * @author Stagiaire
 */
public class ITajoutClient extends javax.swing.JFrame {
	public Ioperation Io;
    /**
     * Creates new form ITajoutUtilisateur
     */
	@SuppressWarnings("unchecked")
    // <editor-fold defaultstate="collapsed" desc="Generated Code">//GEN-BEGIN:initComponents
    public ITajoutClient(Ioperation Io) {
    	setMinimumSize(new Dimension(527, 450));
    	this.Io=Io;
        initComponents();
        cbEntite.removeAllItems();
        cbEntite.addItem("Entreprise");
        cbEntite.addItem("Particulier");
    }

    /**
     * This method is called from within the constructor to initialize the form.
     * WARNING: Do NOT modify this code. The content of this method is always
     * regenerated by the Form Editor.
     */
    @SuppressWarnings("unchecked")
    // <editor-fold defaultstate="collapsed" desc="Generated Code">//GEN-BEGIN:initComponents
    private void initComponents() {

        jSeparator2 = new javax.swing.JSeparator();
        btnCancel = new javax.swing.JButton();
        btnSubmit = new javax.swing.JButton();
        labelTitle = new javax.swing.JLabel();
        labelChoice = new javax.swing.JLabel();
        jSeparator1 = new javax.swing.JSeparator();
        jLabel1 = new javax.swing.JLabel();
        txtNom = new javax.swing.JTextField();
        jLabel2 = new javax.swing.JLabel();
        txtPrenom = new javax.swing.JTextField();
        jLabel3 = new javax.swing.JLabel();
        txtEmail = new javax.swing.JTextField();
        jLabel4 = new javax.swing.JLabel();
        jLabel5 = new javax.swing.JLabel();
        txtComment = new javax.swing.JTextField();
        jLabel6 = new javax.swing.JLabel();
        txtAdresseRue = new javax.swing.JTextField();

        setDefaultCloseOperation(javax.swing.WindowConstants.EXIT_ON_CLOSE);

        btnCancel.setText("Retourner √† l'accueil");
        btnCancel.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                btnCancelActionPerformed(evt);
            }
        });

        btnSubmit.setText("Valider la cr√©ation");
        btnSubmit.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                btnSubmitActionPerformed(evt);
            }
        });

        labelTitle.setHorizontalAlignment(javax.swing.SwingConstants.CENTER);
        labelTitle.setText("Option Administrateur : Cr√©ation d'un utilisateur");

        labelChoice.setText("Vous pouvez ici cr√©er un utilisateur pour l'application locale");

        jLabel1.setText("Nom : ");

        jLabel2.setText("Pr√©nom :");

        jLabel3.setText("Email :");

        jLabel4.setText("Telephone: ");

        jLabel5.setText("Commentaire");

        jLabel6.setText("Adresse(rue)");
        
        txtPhone = new JTextField();
        txtPhone.setColumns(10);
        
        cbEntite = new JComboBox();
        
        JLabel lblEntit = new JLabel();
        lblEntit.setText("Entit\u00E9");
        
        lblAdresseville = new JLabel();
        lblAdresseville.setText("Adresse(ville)");
        
        txtAdresseVille = new JTextField();
        
        cbEntite.setModel(new javax.swing.DefaultComboBoxModel<>(new String[] { "Item 1", "Item 2", "Item 3", "Item 4" }));

        javax.swing.GroupLayout layout = new javax.swing.GroupLayout(getContentPane());
        layout.setHorizontalGroup(
        	layout.createParallelGroup(Alignment.LEADING)
        		.addGroup(layout.createSequentialGroup()
        			.addGroup(layout.createParallelGroup(Alignment.LEADING)
        				.addGroup(layout.createSequentialGroup()
        					.addGap(6)
        					.addComponent(jSeparator1, GroupLayout.PREFERRED_SIZE, GroupLayout.DEFAULT_SIZE, GroupLayout.PREFERRED_SIZE))
        				.addGroup(layout.createSequentialGroup()
        					.addGap(6)
        					.addComponent(btnSubmit)
        					.addPreferredGap(ComponentPlacement.RELATED, 225, Short.MAX_VALUE)
        					.addComponent(btnCancel))
        				.addGroup(layout.createSequentialGroup()
        					.addContainerGap()
        					.addComponent(jSeparator2, GroupLayout.PREFERRED_SIZE, GroupLayout.DEFAULT_SIZE, GroupLayout.PREFERRED_SIZE))
        				.addGroup(layout.createSequentialGroup()
        					.addContainerGap()
        					.addComponent(labelTitle, GroupLayout.DEFAULT_SIZE, 523, Short.MAX_VALUE))
        				.addGroup(layout.createSequentialGroup()
        					.addGroup(layout.createParallelGroup(Alignment.LEADING, false)
        						.addGroup(layout.createSequentialGroup()
        							.addContainerGap()
        							.addGroup(layout.createParallelGroup(Alignment.LEADING)
        								.addComponent(jLabel6)
        								.addComponent(lblAdresseville))
        							.addGap(15)
        							.addGroup(layout.createParallelGroup(Alignment.LEADING)
        								.addComponent(txtAdresseRue, GroupLayout.PREFERRED_SIZE, 162, GroupLayout.PREFERRED_SIZE)
        								.addComponent(txtAdresseVille, GroupLayout.PREFERRED_SIZE, 162, GroupLayout.PREFERRED_SIZE))
        							.addGap(47)
        							.addComponent(lblEntit, GroupLayout.PREFERRED_SIZE, 40, GroupLayout.PREFERRED_SIZE)
        							.addGap(18)
        							.addComponent(cbEntite, 0, GroupLayout.DEFAULT_SIZE, Short.MAX_VALUE))
        						.addGroup(layout.createSequentialGroup()
        							.addContainerGap()
        							.addGroup(layout.createParallelGroup(Alignment.LEADING, false)
        								.addGroup(layout.createSequentialGroup()
        									.addComponent(jLabel5)
        									.addGap(18)
        									.addComponent(txtComment))
        								.addGroup(layout.createSequentialGroup()
        									.addGroup(layout.createParallelGroup(Alignment.LEADING)
        										.addGroup(layout.createSequentialGroup()
        											.addComponent(jLabel1)
        											.addPreferredGap(ComponentPlacement.RELATED)
        											.addComponent(txtNom, GroupLayout.PREFERRED_SIZE, 162, GroupLayout.PREFERRED_SIZE))
        										.addGroup(layout.createSequentialGroup()
        											.addComponent(jLabel3)
        											.addPreferredGap(ComponentPlacement.RELATED)
        											.addComponent(txtEmail, GroupLayout.PREFERRED_SIZE, 162, GroupLayout.PREFERRED_SIZE)))
        									.addGap(18)
        									.addGroup(layout.createParallelGroup(Alignment.LEADING)
        										.addComponent(jLabel2, Alignment.TRAILING)
        										.addComponent(jLabel4, Alignment.TRAILING))
        									.addGap(18)
        									.addGroup(layout.createParallelGroup(Alignment.LEADING, false)
        										.addComponent(txtPrenom)
        										.addComponent(txtPhone)))))
        						.addGroup(layout.createSequentialGroup()
        							.addGap(6)
        							.addComponent(labelChoice)))
        					.addGap(95, 95, Short.MAX_VALUE)))
        			.addContainerGap())
        );
        layout.setVerticalGroup(
        	layout.createParallelGroup(Alignment.TRAILING)
        		.addGroup(layout.createSequentialGroup()
        			.addContainerGap()
        			.addComponent(labelTitle)
        			.addGap(18)
        			.addComponent(labelChoice)
        			.addPreferredGap(ComponentPlacement.UNRELATED)
        			.addComponent(jSeparator1, GroupLayout.PREFERRED_SIZE, GroupLayout.DEFAULT_SIZE, GroupLayout.PREFERRED_SIZE)
        			.addPreferredGap(ComponentPlacement.RELATED)
        			.addGroup(layout.createParallelGroup(Alignment.BASELINE)
        				.addComponent(jLabel1)
        				.addComponent(txtNom, GroupLayout.PREFERRED_SIZE, GroupLayout.DEFAULT_SIZE, GroupLayout.PREFERRED_SIZE)
        				.addComponent(jLabel2)
        				.addComponent(txtPrenom, GroupLayout.PREFERRED_SIZE, GroupLayout.DEFAULT_SIZE, GroupLayout.PREFERRED_SIZE))
        			.addGap(18)
        			.addGroup(layout.createParallelGroup(Alignment.BASELINE)
        				.addComponent(jLabel3)
        				.addComponent(txtEmail, GroupLayout.PREFERRED_SIZE, GroupLayout.DEFAULT_SIZE, GroupLayout.PREFERRED_SIZE)
        				.addComponent(jLabel4)
        				.addComponent(txtPhone, GroupLayout.PREFERRED_SIZE, GroupLayout.DEFAULT_SIZE, GroupLayout.PREFERRED_SIZE))
        			.addGap(18)
        			.addGroup(layout.createParallelGroup(Alignment.BASELINE)
        				.addComponent(jLabel5)
        				.addComponent(txtComment, GroupLayout.PREFERRED_SIZE, 84, GroupLayout.PREFERRED_SIZE))
        			.addGroup(layout.createParallelGroup(Alignment.LEADING)
        				.addGroup(layout.createSequentialGroup()
        					.addGap(18)
        					.addGroup(layout.createParallelGroup(Alignment.BASELINE)
        						.addComponent(jLabel6)
        						.addComponent(cbEntite, GroupLayout.PREFERRED_SIZE, GroupLayout.DEFAULT_SIZE, GroupLayout.PREFERRED_SIZE)
        						.addComponent(lblEntit))
        					.addPreferredGap(ComponentPlacement.RELATED, 59, Short.MAX_VALUE)
        					.addComponent(jSeparator2, GroupLayout.PREFERRED_SIZE, 10, GroupLayout.PREFERRED_SIZE))
        				.addGroup(layout.createSequentialGroup()
        					.addPreferredGap(ComponentPlacement.UNRELATED)
        					.addComponent(txtAdresseRue, GroupLayout.PREFERRED_SIZE, GroupLayout.DEFAULT_SIZE, GroupLayout.PREFERRED_SIZE)
        					.addPreferredGap(ComponentPlacement.RELATED)
        					.addGroup(layout.createParallelGroup(Alignment.BASELINE)
        						.addComponent(txtAdresseVille, GroupLayout.PREFERRED_SIZE, GroupLayout.DEFAULT_SIZE, GroupLayout.PREFERRED_SIZE)
        						.addComponent(lblAdresseville))))
        			.addPreferredGap(ComponentPlacement.UNRELATED)
        			.addGroup(layout.createParallelGroup(Alignment.BASELINE)
        				.addComponent(btnSubmit)
        				.addComponent(btnCancel))
        			.addContainerGap())
        );
        getContentPane().setLayout(layout);

        pack();
    }// </editor-fold>//GEN-END:initComponents

    private void btnCancelActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_btnCancelActionPerformed
        int choice;
        choice = (int)JOptionPane.showConfirmDialog(null, "Voulez-vous vraiment annuler la cr√©ation ?", "Annuler", JOptionPane.YES_NO_OPTION);
        if(choice == 0){
            this.dispose();    
        }
    }//GEN-LAST:event_btnCancelActionPerformed
/**
 * Cette fonction sert √† cr√©er un nouvel utilisateur en v√©rifiant que tous les champs soient remplis et que les donn√©es soient disponibles (email, login uniques).
 * @param evt 
 */
    private void btnSubmitActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_btnSubmitActionPerformed
        try {
        	String nom, prenom, email, comment, phone, entite, adresseRue, adresseVille;
            nom = this.txtNom.getText();
            prenom = this.txtPrenom.getText();
            email = this.txtEmail.getText();
            comment = this.txtComment.getText();
            phone = this.txtPhone.getText();
            adresseRue = this.txtAdresseRue.getText();
            adresseVille = this.txtAdresseVille.getText();
            entite = this.cbEntite.getSelectedItem().toString();
            int adminnb = -1;
            //boolean admin = this.checkAdmin.isSelected();
        	if(!getTitle().equals("")){
        	    Io.recevoirId(Integer.parseInt(getTitle()));
        	    if(nom.equals("") || prenom.equals("") || email.equals("") || adresseRue.equals("") || adresseVille.equals("") || phone.equals("")){
                    JOptionPane.showMessageDialog(null, "Vous devez renseigner tous les champs !");
                }
                else if(!(checkEmail(email))){
                    JOptionPane.showMessageDialog(null, "Veuillez rentrer une adresse e-mail valide !");
                }
                else if(!(checkPhone(phone))){
        			JOptionPane.showMessageDialog(null, "Veuillez entrer un numero de tÈlÈphone valide");
        		}
                else{
                	String adresse=adresseRue+", "+adresseVille+"";
                	int choice;
            		choice = (int)JOptionPane.showConfirmDialog(null, "Voulez-vous vraiment cr√©er l'utilisateur suivant ?\nNom : "+nom+", Prenom : "+prenom+"\nEmail : "+email+"\nAdresse : "+adresse+", Telephone : "+phone+"\n\n", "Annuler", JOptionPane.YES_NO_OPTION);
            		if(choice == 0){
            			Io.operationClient(nom, prenom, email, phone, adresse, entite, comment);
            			//rq.ajoutUtilisateur(nom, prenom, email, 0, login, mdp);
            			JOptionPane.showMessageDialog(null, "L'utilisateur "+prenom+" "+nom+" a √©t√© cr√©√© avec succ√®s !");
            			this.dispose();
            		}
            		else{
            			JOptionPane.showMessageDialog(null, "Cr√©ation de l'utilisateur "+prenom+" "+nom+" annul√© !");
            		}
                }
        	}
        	else{
            
        		if(nom.equals("") || prenom.equals("") || email.equals("") || adresseRue.equals("") || adresseVille.equals("") || phone.equals("")){
        			JOptionPane.showMessageDialog(null, "Vous devez renseigner tous les champs !");
        		}
        		else if(!(checkEmail(email))){
        			JOptionPane.showMessageDialog(null, "Veuillez rentrer une adresse e-mail valide !");
        		}
        		else if(!(checkPhone(phone))){
        			JOptionPane.showMessageDialog(null, "Veuillez entrer un numero de tÈlÈphone valide");
        		}
        		else if(!(rq.checkClient(nom, prenom, email, phone))){
        			JOptionPane.showMessageDialog(null, "Il semblerait que cet utilisateur existe d√©j√†.");
        		}
            /*else if(!(rq.checkUtilisateurEmail(email))){
                JOptionPane.showMessageDialog(null, "Cet e-mail est d√©j√† utilis√© !");
            }*/
        		else{
        			//if(admin){adminnb=1;}else{adminnb=0;}
        			int choice;
        			String adresse=adresseRue+", "+adresseVille+"";
        			choice = (int)JOptionPane.showConfirmDialog(null, "Voulez-vous vraiment cr√©er l'utilisateur suivant ?\nNom : "+nom+", Prenom : "+prenom+"\nEmail : "+email+"\nAdresse : "+adresse+", Telephone : "+phone+"\n\n", "Annuler", JOptionPane.YES_NO_OPTION);
        			if(choice == 0){
        				Io.operationClient(nom, prenom, email, phone, adresse, entite, comment);
        				//rq.ajoutUtilisateur(nom, prenom, email, 0, login, mdp);
        				JOptionPane.showMessageDialog(null, "L'utilisateur "+prenom+" "+nom+" a √©t√© cr√©√© avec succ√®s !");
        				this.dispose();
        			}
        			else{
        				JOptionPane.showMessageDialog(null, "Cr√©ation de l'utilisateur "+prenom+" "+nom+" annul√© !");
        			}  
        		}
        	}
        } catch (SQLException ex) {
            Logger.getLogger(ITajoutClient.class.getName()).log(Level.SEVERE, null, ex);
        }
    }//GEN-LAST:event_btnSubmitActionPerformed

    /**
     * Cette fonction sert √† la validation partielle d'un email.
     * @param email
     * @return 
     */
    public static boolean checkEmail(String email){
        boolean arobase = false, point = false;
        for(int i = 0 ; i<email.length() ; i++){
            if(email.charAt(i) == '@'){
                arobase = true;
            }
            else if(email.charAt(i) == '.' && arobase == true){
                point = true;
            }
            //System.out.println(email.charAt(i));
        }
        if(arobase == true && point == true){
            return true;
        }
        return false;
    }
    
    public boolean checkPhone(String phone){
    	try {
    		int i = Integer.parseInt(phone);
    		return true;
    		}
    		catch (Exception e) {
    		return false;
    		}
    }
    
    
    
    public void setComment (String comment){
    	txtComment.setText(comment);
    }
    
    public void setAdresse (String adresse){
    	txtAdresseRue.setText(adresse.split(",")[0]);
    	txtAdresseVille.setText(adresse.split(",")[1]);
    }
    
    public void setPrenom (String prenom){
    	txtPrenom.setText(prenom);
    }
    
    public void setNom (String nom){
    	txtNom.setText(nom);
    }
    
    public void setMail (String mail){
    	txtEmail.setText(mail);
    }
    
    public void setPhone (String phone){
    	txtPhone.setText(phone);
    }
    
    public void setEntite (String entite){
    	cbEntite.setSelectedItem(entite);
    }
    
    
    
    

    // Variables declaration - do not modify//GEN-BEGIN:variables
    private javax.swing.JButton btnCancel;
    private javax.swing.JButton btnSubmit;
    private javax.swing.JLabel jLabel1;
    private javax.swing.JLabel jLabel2;
    private javax.swing.JLabel jLabel3;
    private javax.swing.JLabel jLabel4;
    private javax.swing.JLabel jLabel5;
    private javax.swing.JLabel jLabel6;
    private javax.swing.JSeparator jSeparator1;
    private javax.swing.JSeparator jSeparator2;
    private javax.swing.JLabel labelChoice;
    private javax.swing.JLabel labelTitle;
    private javax.swing.JTextField txtEmail;
    private javax.swing.JTextField txtComment;
    private javax.swing.JTextField txtAdresseRue;
    private javax.swing.JTextField txtNom;
    private javax.swing.JTextField txtPrenom;
    private javax.swing.JTextField txtPhone;
    private JComboBox cbEntite;
    private JLabel lblAdresseville;
    private JTextField txtAdresseVille;
}
